<?xml version="1.0" encoding="UTF-8"?>
<microprocessor name="RC Car Controller" description="A microcontroller used to control RC Car" width="4" length="2" id_counter="68" id_counter_node="14" sym1="8204" sym2="22482" sym3="12242" sym4="2028" sym5="1008" sym6="254" sym7="62" sym9="8" sym10="8" sym11="4" sym12="4" sym13="2">
	<nodes>
		<n id="1" component_id="2">
			<node label="Remote input" mode="1" type="5" description="The input signal to be processed."/>
		</n>
		<n id="2" component_id="5">
			<node label="Right Wheel" type="1" description="The input signal to be processed.">
				<position x="2" z="1"/>
			</node>
		</n>
		<n id="3" component_id="8">
			<node label="W / S" type="1" description="The input signal to be processed.">
				<position x="3" z="1"/>
			</node>
		</n>
		<n id="4" component_id="10">
			<node label="Brake" description="The input signal to be processed.">
				<position x="2"/>
			</node>
		</n>
		<n id="9" component_id="46">
			<node label="Signal Strength" mode="1" type="1" description="The input signal to be processed.">
				<position z="1"/>
			</node>
		</n>
		<n id="10" component_id="49">
			<node label="Is connected" description="The input signal to be processed.">
				<position x="1"/>
			</node>
		</n>
		<n id="11" component_id="53">
			<node label="Left Wheel" type="1" description="The input signal to be processed.">
				<position x="1" z="1"/>
			</node>
		</n>
		<n id="12" component_id="59">
			<node label="Frequency" type="1" description="The input signal to be processed.">
				<position x="3"/>
			</node>
		</n>
	</nodes>
	<group>
		<data>
			<inputs/>
			<outputs/>
		</data>
		<components>
			<c type="56">
				<object id="26" script='lastAD = 0
lastWS = 0

frequency = property.getNumber("Frequency")

function round(num, numDecimalPlaces)
  local mult = 10^(numDecimalPlaces or 0)
  return math.floor(num * mult + 0.5) / mult
end

function onTick()
	output.setNumber(4, frequency)
	resultAD = 0
	resultWS = 0
	
	AD = input.getNumber(1)
	WS = input.getNumber(2)
	connectionDistance = input.getNumber(3)
	
	braking = input.getBool(31)
	
	if connectionDistance ~= 0 then
		output.setBool(1, braking)
		output.setBool(2, true)
	
		deltaAD = AD - lastAD
		deltaWS = WS - lastWS
	
		diffAD = math.abs(round(deltaAD / AD, 2) + 0.01)
		diffWS = math.abs(round(deltaWS / WS, 2) + 0.01)
	
		output.setNumber(5, deltaAD)
		output.setNumber(6, diffAD)
	
		if diffAD &lt; 0.002 then
			resultAD = 0
		else
			if deltaAD &gt; 0 then resultAD = 1 end
			if deltaAD &lt; 0 then resultAD = -1 end
		end
		
		if diffWS &lt; 0.002 then
			resultWS = 0
		else
			if deltaWS &gt; 0 then resultWS = 1 end
			if deltaWS &lt; 0 then resultWS = -1 end
		end
	
		output.setNumber(1, resultAD)
		output.setNumber(2, -resultAD)
		output.setNumber(3, resultWS)
	
		lastAD = AD
		lastWS = WS
	else
		output.setBool(1, true)
		output.setBool(2, false)
		output.setNumber(1, 0)
		output.setNumber(2, 0)
		output.setNumber(3, 0)
		lastAD = 0
		lastWS = 0
	end
end'>
					<pos x="-3.5"/>
					<in1 component_id="47"/>
					<out1>
						<v bools="1" 04="1" 05="-0.001232"/>
					</out1>
				</object>
			</c>
			<c type="31">
				<object id="27">
					<pos x="-2" y="0.75"/>
					<in1 component_id="26">
						<v bools="1" 04="1" 05="-0.001232"/>
					</in1>
				</object>
			</c>
			<c type="31">
				<object id="28" i="1">
					<pos x="-2" y="0.25"/>
					<in1 component_id="26">
						<v bools="1" 04="1" 05="-0.001232"/>
					</in1>
				</object>
			</c>
			<c type="29">
				<object id="29">
					<pos x="-2" y="-1.25"/>
					<in1 component_id="26">
						<v bools="1" 04="1" 05="-0.001232"/>
					</in1>
					<out1 v="true"/>
				</object>
			</c>
			<c type="40">
				<object id="47" count="1" offset="2">
					<pos x="-4.75"/>
					<inc component_id="2"/>
					<in1 component_id="46"/>
				</object>
			</c>
			<c type="29">
				<object id="50" i="1">
					<pos x="-2" y="-1.75"/>
					<in1 component_id="26">
						<v bools="1" 04="1" 05="-0.001232"/>
					</in1>
				</object>
			</c>
			<c type="31">
				<object id="56" i="2">
					<pos x="-2" y="-0.25"/>
					<in1 component_id="26">
						<v bools="1" 04="1" 05="-0.001232"/>
					</in1>
				</object>
			</c>
			<c type="19">
				<object id="58" name="Frequency">
					<pos x="-3.5" y="0.75"/>
					<out1 v="1"/>
					<min text="0"/>
					<max text="8" value="8"/>
					<int text="1" value="1"/>
					<v text="1" value="1"/>
				</object>
			</c>
			<c type="31">
				<object id="60" i="3">
					<pos x="-2" y="-0.75"/>
					<in1 component_id="26">
						<v bools="1" 04="1" 05="-0.001232"/>
					</in1>
					<out1 v="1"/>
				</object>
			</c>
		</components>
		<components_bridge>
			<c type="4">
				<object id="2">
					<pos x="-6" y="0.25"/>
				</object>
			</c>
			<c type="3">
				<object id="5">
					<pos x="-0.5" y="0.75"/>
					<in1 component_id="27"/>
				</object>
			</c>
			<c type="3">
				<object id="8">
					<pos x="-0.5" y="-0.25"/>
					<in1 component_id="56"/>
				</object>
			</c>
			<c type="1">
				<object id="10">
					<pos x="-0.5" y="-1.25"/>
					<in1 component_id="29" v="true"/>
					<out1 v="true"/>
				</object>
			</c>
			<c type="2">
				<object id="46">
					<pos x="-6" y="-0.25"/>
				</object>
			</c>
			<c type="1">
				<object id="49">
					<pos x="-0.5" y="-1.75"/>
					<in1 component_id="50"/>
				</object>
			</c>
			<c type="3">
				<object id="53">
					<pos x="-0.5" y="0.25"/>
					<in1 component_id="28"/>
				</object>
			</c>
			<c type="3">
				<object id="59">
					<pos x="-0.5" y="-0.75"/>
					<in1 component_id="60" v="1"/>
					<out1 v="1"/>
				</object>
			</c>
		</components_bridge>
		<groups/>
		<component_states>
			<c0 id="26" script='lastAD = 0
lastWS = 0

frequency = property.getNumber("Frequency")

function round(num, numDecimalPlaces)
  local mult = 10^(numDecimalPlaces or 0)
  return math.floor(num * mult + 0.5) / mult
end

function onTick()
	output.setNumber(4, frequency)
	resultAD = 0
	resultWS = 0
	
	AD = input.getNumber(1)
	WS = input.getNumber(2)
	connectionDistance = input.getNumber(3)
	
	braking = input.getBool(31)
	
	if connectionDistance ~= 0 then
		output.setBool(1, braking)
		output.setBool(2, true)
	
		deltaAD = AD - lastAD
		deltaWS = WS - lastWS
	
		diffAD = math.abs(round(deltaAD / AD, 2) + 0.01)
		diffWS = math.abs(round(deltaWS / WS, 2) + 0.01)
	
		output.setNumber(5, deltaAD)
		output.setNumber(6, diffAD)
	
		if diffAD &lt; 0.002 then
			resultAD = 0
		else
			if deltaAD &gt; 0 then resultAD = 1 end
			if deltaAD &lt; 0 then resultAD = -1 end
		end
		
		if diffWS &lt; 0.002 then
			resultWS = 0
		else
			if deltaWS &gt; 0 then resultWS = 1 end
			if deltaWS &lt; 0 then resultWS = -1 end
		end
	
		output.setNumber(1, resultAD)
		output.setNumber(2, -resultAD)
		output.setNumber(3, resultWS)
	
		lastAD = AD
		lastWS = WS
	else
		output.setBool(1, true)
		output.setBool(2, false)
		output.setNumber(1, 0)
		output.setNumber(2, 0)
		output.setNumber(3, 0)
		lastAD = 0
		lastWS = 0
	end
end'>
				<pos x="-3.5"/>
				<in1 component_id="47"/>
				<out1>
					<v bools="1" 04="1" 05="-0.001232"/>
				</out1>
			</c0>
			<c1 id="27">
				<pos x="-2" y="0.75"/>
				<in1 component_id="26">
					<v bools="1" 04="1" 05="-0.001232"/>
				</in1>
			</c1>
			<c2 id="28" i="1">
				<pos x="-2" y="0.25"/>
				<in1 component_id="26">
					<v bools="1" 04="1" 05="-0.001232"/>
				</in1>
			</c2>
			<c3 id="29">
				<pos x="-2" y="-1.25"/>
				<in1 component_id="26">
					<v bools="1" 04="1" 05="-0.001232"/>
				</in1>
				<out1 v="true"/>
			</c3>
			<c4 id="47" count="1" offset="2">
				<pos x="-4.75"/>
				<inc component_id="2"/>
				<in1 component_id="46"/>
			</c4>
			<c5 id="50" i="1">
				<pos x="-2" y="-1.75"/>
				<in1 component_id="26">
					<v bools="1" 04="1" 05="-0.001232"/>
				</in1>
			</c5>
			<c6 id="56" i="2">
				<pos x="-2" y="-0.25"/>
				<in1 component_id="26">
					<v bools="1" 04="1" 05="-0.001232"/>
				</in1>
			</c6>
			<c7 id="58" name="Frequency">
				<pos x="-3.5" y="0.75"/>
				<out1 v="1"/>
				<min text="0"/>
				<max text="8" value="8"/>
				<int text="1" value="1"/>
				<v text="1" value="1"/>
			</c7>
			<c8 id="60" i="3">
				<pos x="-2" y="-0.75"/>
				<in1 component_id="26">
					<v bools="1" 04="1" 05="-0.001232"/>
				</in1>
				<out1 v="1"/>
			</c8>
		</component_states>
		<component_bridge_states>
			<c0 id="2">
				<pos x="-6" y="0.25"/>
			</c0>
			<c1 id="5">
				<pos x="-0.5" y="0.75"/>
				<in1 component_id="27"/>
			</c1>
			<c2 id="8">
				<pos x="-0.5" y="-0.25"/>
				<in1 component_id="56"/>
			</c2>
			<c3 id="10">
				<pos x="-0.5" y="-1.25"/>
				<in1 component_id="29" v="true"/>
				<out1 v="true"/>
			</c3>
			<c4 id="46">
				<pos x="-6" y="-0.25"/>
			</c4>
			<c5 id="49">
				<pos x="-0.5" y="-1.75"/>
				<in1 component_id="50"/>
			</c5>
			<c6 id="53">
				<pos x="-0.5" y="0.25"/>
				<in1 component_id="28"/>
			</c6>
			<c7 id="59">
				<pos x="-0.5" y="-0.75"/>
				<in1 component_id="60" v="1"/>
				<out1 v="1"/>
			</c7>
		</component_bridge_states>
		<group_states/>
	</group>
</microprocessor>

